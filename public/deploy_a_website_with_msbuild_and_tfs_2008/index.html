<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Deploying a website with MSBuild and TFS 2008</title>
    <meta name="description" content="Stuff I have time to write about
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://jjasonclark.com/deploy_a_website_with_msbuild_and_tfs_2008">

    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-12083278-1']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">JJasonClark.com</a>

    <nav class="site-nav">
      <div class="trigger">
        
          
          <a class="page-link" href="/contact">Contact me</a>
          
        
          
        
          
        
          
        
        <div class='social'>
<a href="http://github.com/jjasonclark" title="Jason Clark on Github" class='social_button'>
  <img src="/assets/github.png" alt="Jason Clark on Github" width=24 height=24 />
</a>
<a href="/index.xml" title="Subscribe to JJasonClark.com" class='social_button'>
 <img src="/assets/feed.png" alt="Subscribe to JJasonClark.com" width=24 height=24 />
</a>
<a href="https://twitter.com/share" class='twitter-share-button' data-url="/deploy_a_website_with_msbuild_and_tfs_2008" via="jjasonclark" lang="en">Tweet</a>
<div class='g-plusone'></div>
</div>
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="left_bar">

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:600px"
     data-ad-client="ca-pub-3509568712949908"
     data-ad-slot="8275695470"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div>

      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Deploying a website with MSBuild and TFS 2008</h1>
    <p class="post-meta">Oct 22, 2009 • <a title="Jason Clark" rel="author" href="https://plus.google.com/117263003751658777941">Jason Clark</a></p>
  </header>

  <article class="post-content">
    <p>This past week I have been working on getting the product that I work on into TFS and building on a regular schedule. This is a basic web application built on the Microsoft stack. We have a web site, a database, and some DLLs for business logic.</p>

<p>Before this change the product was built using a home grown build system built by another team in the company.  It has been a long time since this build process has been updated. Basically it was setup to build and deploy to 1 server and nothing has changed since. This isn&rsquo;t really a problem for the group. All of the changes happen at the solution level or project level which doesn&rsquo;t require any changes to the automated build process.</p>

<p>Now that we have shipped the latest version we have an opportunity to switch to TFS. The team is already using TFS to track bugs and work items so they are anticipating the switch for the build. Linking to source code changes and getting better code coverage results seem to be the most important parts.</p>

<p>In order for this to work I had to translate all of our current batch files into MSBuild tasks. At the same time we are moving from IIS6 to IIS7, so some of the commands need to be updated.  I started by creating a basic TFS build definition. This is because all of the real work is done in the project file.</p>

<p><div class="highlight"><pre><span class="nt">&lt;PropertyGroup&gt;</span>
    <span class="nt">&lt;SDLTrackWebSitePath&gt;</span>D:\SDLTrackWeb<span class="nt">&lt;/SDLTrackWebSitePath&gt;</span>
    <span class="nt">&lt;SDLTrackDatabasePath&gt;</span>D:\SDLTrackDBs<span class="nt">&lt;/SDLTrackDatabasePath&gt;</span>
    <span class="nt">&lt;SDLTrackUploadPath&gt;</span>D:\SDLTrackFiles<span class="nt">&lt;/SDLTrackUploadPath&gt;</span>
    <span class="nt">&lt;SDLTrackConsolePath&gt;</span>D:\SDLTrackConsole<span class="nt">&lt;/SDLTrackConsolePath&gt;</span>
    <span class="nt">&lt;SDLTrackAgileSDLVersionID&gt;</span>1007<span class="nt">&lt;/SDLTrackAgileSDLVersionID&gt;</span>
    <span class="nt">&lt;SDLTrackClassicSDLVersionID&gt;</span>1008<span class="nt">&lt;/SDLTrackClassicSDLVersionID&gt;</span>
    <span class="nt">&lt;SDLTrackApplicationPool&gt;</span>DailyBuildAppPool<span class="nt">&lt;/SDLTrackApplicationPool&gt;</span>
    <span class="nt">&lt;SDLTrackBaseWebSite&gt;</span>Default Web Site<span class="nt">&lt;/SDLTrackBaseWebSite&gt;</span>
<span class="nt">&lt;/PropertyGroup&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;AfterEndToEndIteration&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;CallTarget</span> <span class="na">Targets=</span><span class="s">&quot;CopyWebSiteToIIS&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;CallTarget</span> <span class="na">Targets=</span><span class="s">&quot;RegisterWebSiteInIIS&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;CallTarget</span> <span class="na">Targets=</span><span class="s">&quot;UpdateWebConfig&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;CallTarget</span> <span class="na">Targets=</span><span class="s">&quot;TurnOnWindowsAuthenticationOnly&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;CallTarget</span> <span class="na">Targets=</span><span class="s">&quot;DeploySDLTrackConsole&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;CopyWebSiteToIIS&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Message</span> <span class="na">Text=</span><span class="s">&quot;Copying files from $(OutDir)_PublishedWebsites\Web to $(SDLTrackWebSitePath)\$(BuildNumber)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;ItemGroup&gt;</span>
        <span class="nt">&lt;WebFilesToCopy</span> <span class="na">Include=</span><span class="s">&quot;$(OutDir)_PublishedWebsites\Web\**\*.*&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ItemGroup&gt;</span>

    <span class="nt">&lt;Copy</span> <span class="na">Condition=</span><span class="s">&quot; &#39;$(BuildBreak)&#39;!=&#39;true&#39; &quot;</span>
        <span class="na">SourceFiles=</span><span class="s">&quot;@(WebFilesToCopy)&quot;</span>
        <span class="na">DestinationFiles=</span><span class="s">&quot;@(WebFilesToCopy -&gt;&#39;$(SDLTrackWebSitePath)\$(BuildNumber)\%(RecursiveDir)%(Filename)%(Extension)&#39;)&quot;</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;Copy</span> <span class="na">Condition=</span><span class="s">&quot; &#39;$(BuildBreak)&#39;==&#39;true&#39; &quot;</span>
        <span class="na">SourceFiles=</span><span class="s">&quot;@(WebFilesToCopy)&quot;</span>
        <span class="na">DestinationFiles=</span><span class="s">&quot;@(WebFilesToCopy -&gt;&#39;$(SDLTrackWebSitePath)\$(BuildNumber)\%(RecursiveDir)%(Filename)%(Extension)&#39;)&quot;</span>
        <span class="na">ContinueOnError=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;RegisterWebSiteInIIS&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd add app /site.name:&quot;</span><span class="err">$(SDLTrackBaseWebSite)&quot;</span> <span class="err">/path:/$(BuildNumber)</span> <span class="err">/physicalPath:$(SDLTrackWebSitePath)\$(BuildNumber)</span> <span class="err">/applicationPool:&quot;$(SDLTrackApplicationPool)&quot;&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;UpdateWebConfig&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Copy</span> <span class="na">SourceFiles=</span><span class="s">&quot;$(SolutionRoot)\$(TeamProject)\Misc\UnitTest\Setup\Web\ModifyWebConfig\WebTemplate.config&quot;</span>
        <span class="na">DestinationFiles=</span><span class="s">&quot;$(SDLTrackWebSitePath)\$(BuildNumber)\web.config&quot;</span>
        <span class="na">OverwriteReadOnlyFiles=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:appSettings</span> <span class="err">/[</span><span class="na">key=</span><span class="s">&#39;connectionString&#39;</span><span class="err">].value:&quot;</span><span class="na">server=</span><span class="s">(local);database=$(BuildNumber);integrated</span> <span class="na">security=</span><span class="s">true;&quot;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:appSettings</span> <span class="err">/[</span><span class="na">key=</span><span class="s">&#39;filePath&#39;</span><span class="err">].value:&quot;$(SDLTrackUploadPath)\$(BuildNumber)&quot;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:appSettings</span> <span class="err">/[</span><span class="na">key=</span><span class="s">&#39;pluginPath&#39;</span><span class="err">].value:&quot;$(SDLTrackWebSitePath)\$(BuildNumber)\Bin&quot;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:appSettings</span> <span class="err">/[</span><span class="na">key=</span><span class="s">&#39;currentSDLVersionID&#39;</span><span class="err">].value:&quot;$(SDLTrackClassicSDLVersionID)&quot;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:appSettings</span> <span class="err">/[</span><span class="na">key=</span><span class="s">&#39;currentAgileSDLVersionID&#39;</span><span class="err">].value:&quot;$(SDLTrackAgileSDLVersionID)&quot;&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:appSettings</span> <span class="err">/[</span><span class="na">key=</span><span class="s">&#39;baseWebAddress&#39;</span><span class="err">].value:&quot;$(ComputerName)/$(BuildNumber)&quot;&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;TurnOnWindowsAuthenticationOnly&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- Set access level to be windows only--&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:system.webServer/security/authentication/windowsAuthentication</span> <span class="err">/enabled:true</span> <span class="err">/commit:apphost&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:system.web/authentication</span> <span class="err">/mode:Windows&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;%SystemRoot%\System32\inetsrv\appcmd set config &quot;</span><span class="err">$(SDLTrackBaseWebSite)/$(BuildNumber)&quot;</span> <span class="err">/section:system.webServer/security/authentication/anonymousAuthentication</span> <span class="err">/enabled:false</span> <span class="err">/commit:apphost&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>

<span class="nt">&lt;Target</span> <span class="na">Name=</span><span class="s">&quot;DeploySDLTrackConsole&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Copy</span> <span class="na">SourceFiles=</span><span class="s">&quot;$(OutDir)\SWITrackConsole.exe&quot;</span> <span class="na">DestinationFolder=</span><span class="s">&quot;$(SDLTrackConsolePath)\$(BuildNumber)&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Copy</span> <span class="na">SourceFiles=</span><span class="s">&quot;$(SolutionRoot)\$(TeamProject)\Misc\UnitTest\Setup\Console\ModifyAppConfig\SWITrackConsoleTemplate.config&quot;</span>
        <span class="na">DestinationFiles=</span><span class="s">&quot;$(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot;</span>
        <span class="na">OverwriteReadOnlyFiles=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;echo ^&lt;add key=&quot;</span><span class="err">connectionString&quot;</span> <span class="na">value=</span><span class="s">&quot;Persist Security Info=False;Integrated Security=SSPI;database=$(BuildNumber);server=localhost&quot;</span> <span class="err">/^</span><span class="nt">&gt;</span> &gt;&gt; $(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot; /&gt;
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;echo ^&lt;add key=&quot;</span><span class="err">filePath&quot;</span> <span class="na">value=</span><span class="s">&quot;$(SDLTrackUploadPath)\$(BuildNumber)&quot;</span> <span class="err">/^</span><span class="nt">&gt;</span> &gt;&gt; $(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot; /&gt;
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;echo ^&lt;add key=&quot;</span><span class="err">baseWebAddress&quot;</span> <span class="na">value=</span><span class="s">&quot;$(ComputerName):1%date:~4,2%%date:~7,2%&quot;</span> <span class="err">/^</span><span class="nt">&gt;</span> &gt;&gt; $(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot; /&gt;
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;echo ^&lt;add key=&quot;</span><span class="err">pluginPath&quot;</span> <span class="na">value=</span><span class="s">&quot;$(SDLTrackWebSitePath)\$(BuildNumber)\Bin&quot;</span> <span class="err">/^</span><span class="nt">&gt;</span> &gt;&gt; $(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot; /&gt;
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;echo ^&lt;/appSettings^&gt; &gt;&gt; $(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;Exec</span> <span class="na">Command=</span><span class="s">&quot;echo ^&lt;/configuration^&gt; &gt;&gt; $(SDLTrackConsolePath)\$(BuildNumber)\SWITrackConsole.config&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/Target&gt;</span>
</pre></div>
</p>


  </article>

</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jjasonclark';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <a class="footer-donate" href="http://jjasonclark.tip.me"><img alt="Tip Me With ChangeTip" src="https://cdn.changetip.com/img/logos/tipme_share.png?1"/></a>
    <h2 class="footer-heading">JJasonClark.com</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <li>JJasonClark.com</li>
          <li><a href="mailto:jason@jjasonclark.com">jason@jjasonclark.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jjasonclark">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">jjasonclark</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/jjasonclark">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">jjasonclark</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p>Please donate Bitcoin to 14622f9QThq7ieB1jJ3rHy9Xx4jK8UN7DV</p>
      </div>
    </div>

  </div>

</footer>


    <script type="text/javascript">
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>

<script type="text/javascript">
(function() {
  var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
  po.src = 'https://apis.google.com/js/plusone.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
})();
</script>

  </body>

</html>
